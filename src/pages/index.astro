---
import Layout from '../layouts/Layout.astro';
import Sidebar from '../components/Sidebar.astro';
import client from '../lib/sanity.ts';
import { PortableText } from 'astro-portabletext';
import AnimateOnScroll from '../components/AnimateOnScroll.jsx';

const query = `*[_type == "siteSettings"][0]{...,"experiencies": *[_type == "experiencia"] | order(ordre asc),"formacions": *[_type == "formacio"] | order(ordre asc),"habilitatsTecniques": *[_type == "habilitat" && categoria == "tecnica"] | order(nom asc),"habilitatsClau": *[_type == "habilitat" && categoria == "clau"] | order(nom asc)}`;
const data = await client.fetch(query);
---

<Layout title={data?.nom || 'Portafoli Aitor Rivera'}>
  <div class="max-w-screen-xl mx-auto lg:flex lg:gap-8">
    <Sidebar settings={data} />
    <main class="w-full lg:w-3/5 p-8 lg:p-16 lg:py-24 bg-white/80 dark:bg-slate-900/70 rounded-2xl shadow-xl transition-all duration-500 min-h-screen">
      {data ? (
        <>
          <AnimateOnScroll client:visible>
            <section id="sobre-mi" class="mb-20">
              <h2 class="text-2xl font-bold mb-4 text-indigo-700 dark:text-indigo-300">Sobre mi</h2>
              <p class="text-lg leading-relaxed text-slate-600 dark:text-slate-300">{data.sobreMi}</p>
            </section>
          </AnimateOnScroll>

          <AnimateOnScroll client:visible>
            <section id="experiencia" class="mb-20">
              <h2 class="text-2xl font-bold mb-4 text-indigo-700 dark:text-indigo-300">Experiència</h2>
              <ul class="space-y-6">
                {data.experiencies?.map((exp) => (
                  <li>
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between mb-1">
                      <span class="font-semibold text-lg">{exp.carrec}</span>
                      <span class="text-slate-400 text-sm">{exp.anyInici} – {exp.anyFi || 'Actualitat'}</span>
                    </div>
                    <div class="text-slate-600 dark:text-slate-400 mb-1">{exp.empresa}</div>
                    <div class="text-sm text-slate-500 dark:text-slate-400">
                      <PortableText value={exp.descripcio} />
                    </div>
                  </li>
                ))}
              </ul>
            </section>
          </AnimateOnScroll>

          <AnimateOnScroll client:visible>
            <section id="formacio" class="mb-20">
              <h2 class="text-2xl font-bold mb-4 text-indigo-700 dark:text-indigo-300">Formació</h2>
              <ul class="space-y-4">
                {data.formacions?.map((f) => (
                  <li>
                    <span class="font-medium">{f.titol}</span> — {f.institucio} ({f.anyInici} - {f.anyFi || 'Actualitat'})
                  </li>
                ))}
              </ul>
            </section>
          </AnimateOnScroll>

          <AnimateOnScroll client:visible>
            <section id="skills" class="mb-20">
              <h2 class="text-2xl font-bold mb-4 text-indigo-700 dark:text-indigo-300">Competències tècniques</h2>
              <ul class="flex flex-wrap gap-3">
                {data.habilitatsTecniques?.map((h) => (
                  <li class="bg-indigo-100 dark:bg-indigo-900 px-3 py-1 rounded-full text-indigo-700 dark:text-indigo-200 text-sm">{h.nom}</li>
                ))}
              </ul>
            </section>
          </AnimateOnScroll>

          <AnimateOnScroll client:visible>
            <section id="skills-clau" class="mb-20">
              <h2 class="text-2xl font-bold mb-4 text-indigo-700 dark:text-indigo-300">Competències clau</h2>
              <ul class="flex flex-wrap gap-3">
                {data.habilitatsClau?.map((h) => (
                  <li class="bg-amber-100 dark:bg-amber-900 px-3 py-1 rounded-full text-amber-700 dark:text-amber-200 text-sm">{h.nom}</li>
                ))}
              </ul>
            </section>
          </AnimateOnScroll>
        </>
      ) : (
        <div>Carregant...</div>
      )}
    </main>
  </div>
</Layout>
