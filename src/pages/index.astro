---
// src/pages/index.astro (Versió amb Tailwind)
import Layout from '../layouts/Layout.astro';
import Sidebar from '../components/Sidebar.astro'; // <-- Importem el nostre nou component
import client from '../lib/sanity.ts'; 
import { PortableText } from 'astro-portabletext';

// La consulta a Sanity no canvia
const query = `*[_type == "siteSettings"][0]{
  ...,
  "experiencies": *[_type == "experiencia"] | order(ordre asc),
  "formacions": *[_type == "formacio"] | order(ordre asc),
  "habilitatsTecniques": *[_type == "habilitat" && categoria == "tecnica"],
  "habilitatsClau": *[_type == "habilitat" && categoria == "clau"]
}`;

const data = await client.fetch(query);
---

<Layout title={data?.nom || 'Portafoli Aitor Rivera'}>
    <div class="lg:flex">
        <Sidebar settings={data} />

        <main class="w-full lg:w-3/5 p-8 lg:p-16">
            {data ? (
            <>
                <section id="sobre-mi" class="mb-16 scroll-mt-24">
                    <div class="bg-slate-800 text-slate-200 p-8 rounded-lg border-l-4 border-blue-500 hidden">
                        <p class="text-lg">Soc un desenvolupador apassionat per la tecnologia i la innovació, amb una trajectòria dual que em permet tant construir solucions tècniques robustes com liderar projectes complexos. El meu objectiu és aportar valor en entorns dinàmics, aplicant un alt sentit de la responsabilitat i un compromís total amb cada repte.</p>
                    </div>
                </section>
                <section id="experiencia" class="mb-16 scroll-mt-24">
                    <h3 class="text-sm font-bold uppercase tracking-widest text-slate-500 mb-8 hidden">Experiència</h3>
                    {data.experiencies?.map(feina => (
                        <div class="bg-white border border-slate-200 rounded-lg p-6 mb-6 hidden hover:shadow-xl hover:border-blue-500 transition-all duration-300">
                            <h4 class="text-xl font-bold text-slate-900">{feina.titol}</h4>
                            <h5 class="text-blue-700 font-semibold mb-2">{feina.empresa} | {feina.dates}</h5>
                            <div class="text-slate-600 prose prose-sm max-w-none">
                                <PortableText value={feina.descripcio} />
                            </div>
                        </div>
                    ))}
                </section>
            </>
        ) : (
            <div class="bg-slate-800 text-slate-200 p-8 rounded-lg">
                <p>Connectant amb Sanity i carregant les dades...</p>
            </div>
        )}
        </main>
    </div>
</Layout>