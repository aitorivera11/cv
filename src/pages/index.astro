---
import Layout from '../layouts/Layout.astro';
import Sidebar from '../components/Sidebar.astro';
import client from '../lib/sanity.ts'; 
import { PortableText } from 'astro-portabletext';

const query = `*[_type == "siteSettings"][0]{...,"experiencies": *[_type == "experiencia"] | order(ordre asc),"formacions": *[_type == "formacio"] | order(ordre asc),"habilitatsTecniques": *[_type == "habilitat" && categoria == "tecnica"] | order(nom asc),"habilitatsClau": *[_type == "habilitat" && categoria == "clau"] | order(nom asc)}`;
const data = await client.fetch(query);
---
<Layout title={data?.nom || 'Portafoli Aitor Rivera'}>
  <div class="max-w-screen-xl mx-auto lg:flex">
    <Sidebar settings={data} />
    <main class="w-full lg:w-3/5 p-8 lg:p-12 lg:py-24">
      <section id="sobre-mi" class="mb-16">
        <p class="text-lg leading-relaxed text-slate-600 dark:text-slate-400">Soc un desenvolupador apassionat per la tecnologia i la innovació, amb una trajectòria dual que em permet tant construir solucions tècniques robustes com liderar projectes complexos. El meu objectiu és aportar valor en entorns dinàmics, aplicant un alt sentit de la responsabilitat i un compromís total amb cada repte.</p>
      </section>

      <section id="experiencia" class="mb-16 scroll-mt-24">
        <h3 class="text-sm font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 mb-8">Experiència</h3>
        <div class="flex flex-col gap-y-4">
          {data.experiencies?.map(feina => (
            <a href="#" class="group block p-6 -mx-6 rounded-lg hover:bg-slate-200/75 dark:hover:bg-slate-800/50 transition-all duration-300">
              <div class="grid sm:grid-cols-8 gap-4">
                <div class="sm:col-span-2">
                  <p class="text-sm text-slate-500 dark:text-slate-400 font-semibold uppercase tracking-wider">{feina.dates}</p>
                </div>
                <div class="sm:col-span-6">
                  <h4 class="text-xl font-bold text-slate-900 dark:text-slate-100 group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors">{feina.titol}</h4>
                  <h5 class="font-semibold text-slate-600 dark:text-slate-300 mb-2">{feina.empresa}</h5>
                  <div class="text-slate-600 dark:text-slate-400 prose prose-slate dark:prose-invert max-w-none prose-p:mb-2 prose-ul:list-disc prose-ul:pl-4">
                    <PortableText value={feina.descripcio} />
                  </div>
                  <div class="mt-4 flex flex-wrap gap-2">
                    {feina.tecnologies?.map(tag => <div class="rounded-full bg-blue-100 dark:bg-blue-900/50 px-3 py-1 text-xs font-medium text-blue-800 dark:text-blue-300">{tag}</div>)}
                  </div>
                </div>
              </div>
            </a>
          ))}
        </div>
      </section>
      
      <section id="habilitats" class="mb-16 scroll-mt-24">
        <h3 class="text-sm font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 mb-8">Habilitats</h3>
        <div class="flex flex-wrap gap-2">
            {data.habilitatsTecniques?.map(hab => <div class="rounded-full bg-slate-200 dark:bg-slate-800 px-3 py-1 text-sm font-medium text-slate-700 dark:text-slate-300">{hab.nom}</div>)}
            {data.habilitatsClau?.map(hab => <div class="rounded-full bg-blue-100 dark:bg-blue-900/50 px-3 py-1 text-sm font-medium text-blue-800 dark:text-blue-300">{hab.nom}</div>)}
        </div>
      </section>
      
      <section id="formacio" class="scroll-mt-24">
          <h3 class="text-sm font-bold uppercase tracking-widest text-slate-500 dark:text-slate-400 mb-8">Formació</h3>
          <div class="flex flex-col gap-y-6">
               {data.formacions?.map(estudi => (
                  <div>
                      <h4 class="text-lg font-bold text-slate-900 dark:text-slate-100">{estudi.titulacio}</h4>
                      <p class="text-slate-600 dark:text-slate-400">{estudi.centre} | {estudi.dates}</p>
                  </div>
              ))}
          </div>
      </section>

      <footer class="text-center mt-24 text-slate-500 text-sm">
          <p>Dissenyat amb Astro i Tailwind CSS. Contingut gestionat amb Sanity.io.</p>
          <p>&copy; {new Date().getFullYear()} {data.nom}</p>
      </footer>
    </main>
  </div>
</Layout>